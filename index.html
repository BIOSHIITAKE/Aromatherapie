<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Formulation Clinique Aromathérapie</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background-color:#f7f7f7; }
h1 { color:#2E8B57; }
select, input { padding:5px; margin:5px; width:250px; }
table { border-collapse: collapse; width: 100%; margin-top:20px; background:white;}
th, td { border:1px solid #999; padding:8px; text-align:left;}
th { background:#d3dad9; text-transform:uppercase; }
.alert { color:red; font-weight:bold; }
#mélange { margin-top:20px; }
</style>
</head>
<body>
<h1>Formulation Clinique Aromathérapie</h1>

<h2>Recherche Huile Essentielle</h2>
<label for="searchName">Nom ou molécule :</label>
<input type="text" id="searchName" placeholder="ex : linalol">

<label for="userType">Utilisateur :</label>
<select id="userType">
<option value="adulte">Adulte</option>
<option value="enfant">Enfant (>7 ans)</option>
<option value="grossesse">Grossesse</option>
</select>

<label for="voie">Voie d'utilisation :</label>
<select id="voie">
<option value="cutanee">Cutanée</option>
<option value="diffusion">Diffusion</option>
<option value="orale">Orale</option>
</select>

<button onclick="filterHE()">Rechercher</button>

<h2>Huiles Essentielles Disponibles</h2>
<table id="heTable">
<thead>
<tr><th>Nom</th><th>Molécules</th><th>Propriétés</th><th>Indications</th><th>Voies</th><th>Ajouter</th></tr>
</thead>
<tbody>
</tbody>
</table>

<h2>Mélange Sélectionné</h2>
<table id="melangeTable">
<thead>
<tr><th>HE</th><th>Molécules principales</th><th>Propriétés</th><th>Indications</th><th>Voie d'utilisation</th><th>Pourcentage</th><th>Supprimer</th></tr>
</thead>
<tbody>
</tbody>
</table>
<p id="totalPourcentage">Pourcentage total : 0%</p>
<p id="alertes" class="alert"></p>

<script>
// Données HE
const huiles = [
  {nom:"Lavande vraie", latin:"Lavandula angustifolia", famille:"Lamiaceae", molecules:"Linalol (35%), Acétate de linalyle (40%)", proprietes:"Calmante, Antispasmodique, Régénératrice cutanée", indications:"Stress, Troubles du sommeil", voies:"cutanee,diffusion,olfactive", maxDose:{cutanee:10, diffusion:100, orale:1}},
  {nom:"Tea tree", latin:"Melaleuca alternifolia", famille:"Myrtaceae", molecules:"Terpinène-4-ol (40%), γ-Terpinène (20%)", proprietes:"Antibactérienne, Antifongique, Immunostimulante", indications:"Infections cutanées, Acné", voies:"cutanee,diffusion", maxDose:{cutanee:10, diffusion:100, orale:0.5}},
  {nom:"Menthe poivrée", latin:"Mentha × piperita", famille:"Lamiaceae", molecules:"Menthol (40%), Menthone (20%)", proprietes:"Tonique, Digestive, Antalgique locale", indications:"Maux de tête, Troubles digestifs", voies:"cutanee,orale", maxDose:{cutanee:5, diffusion:0, orale:0.5}},
  {nom:"Citron", latin:"Citrus limon", famille:"Rutaceae", molecules:"Limonène (65%), β-pinène (10%)", proprietes:"Tonique, Dépurative, Antiseptique aérienne", indications:"Fatigue, Digestif", voies:"diffusion,cutanee", maxDose:{cutanee:5, diffusion:100, orale:0}},
  {nom:"Ylang-ylang complète", latin:"Cananga odorata", famille:"Annonaceae", molecules:"Germacrène D (15%), Benzoate de benzyle (10%)", proprietes:"Relaxante, Hypotensive, Aphrodisiaque", indications:"Stress, Hypertension", voies:"cutanee,diffusion", maxDose:{cutanee:5, diffusion:50, orale:0}},
  {nom:"Genévrier commun", latin:"Juniperus communis", famille:"Cupressacées", molecules:"α-pinène, sabinène, myrcène, germacrène, β-caryophyllène, terpinène-4-ol", proprietes:"Anti-inflammatoire, Cholagogue/Choléretique, Anti-infectieuse", indications:"Infections urinaires, Rétention d'eau", voies:"cutanee,orale,diffusion", maxDose:{cutanee:5, diffusion:50, orale:0.5}}
];

// Mélange
let melange = [];

// Afficher toutes les HE au départ
function displayHE(list){
  const tbody = document.querySelector("#heTable tbody");
  tbody.innerHTML="";
  list.forEach((he,i)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${he.nom}</td><td>${he.molecules}</td><td>${he.proprietes}</td><td>${he.indications}</td><td>${he.voies.replace(/,/g,", ")}</td>
    <td><button onclick="addToMelange(${i})">Ajouter</button></td>`;
    tbody.appendChild(tr);
  });
}

// Ajouter au mélange
function addToMelange(index){
  const he = huiles[index];
  if(melange.find(h=>h.nom===he.nom)) return;
  melange.push({...he, pourcentage:0});
  updateMelange();
}

// Supprimer du mélange
function removeFromMelange(index){
  melange.splice(index,1);
  updateMelange();
}

// Mettre à jour le tableau mélange
function updateMelange(){
  const tbody = document.querySelector("#melangeTable tbody");
  tbody.innerHTML="";
  let total=0;
  melange.forEach((he,i)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${he.nom}</td><td>${he.molecules}</td><td>${he.proprietes}</td><td>${he.indications}</td><td>${he.voies.replace(/,/g,", ")}</td>
    <td><input type="number" min="0" max="100" value="${he.pourcentage}" onchange="updatePourcentage(${i},this.value)"></td>
    <td><button onclick="removeFromMelange(${i})">Supprimer</button></td>`;
    tbody.appendChild(tr);
    total+=parseFloat(he.pourcentage);
  });
  document.getElementById("totalPourcentage").innerText="Pourcentage total : "+total+"%";
  checkAlerts();
}

// Mettre à jour pourcentage
function updatePourcentage(index,value){
  melange[index].pourcentage=parseFloat(value);
  updateMelange();
}

// Vérifier alertes
function checkAlerts(){
  let alertText="";
  melange.forEach(he=>{
    melange.forEach(he2=>{
      if(he!==he2 && he.voies.includes("cutanee") && he2.voies.includes("cutanee")){
        // exemple simplifié de synergie à alerter
      }
    });
  });
  const total = melange.reduce((sum,h)=>sum+h.pourcentage,0);
  if(total>100) alertText+="Attention : total > 100%\n";
  document.getElementById("alertes").innerText=alertText;
}

// Filtrer HE
function filterHE(){
  const search = document.getElementById("searchName").value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
  const voie = document.getElementById("voie").value;
  const type = document.getElementById("userType").value;
  const filtered = huiles.filter(h=>{
    const nomNorm = h.nom.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    const molNorm = h.molecules.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    return (nomNorm.includes(search) || molNorm.includes(search)) && h.voies.includes(voie);
  });
  displayHE(filtered);
}

// Initialisation
displayHE(huiles);
</script>

</body>

